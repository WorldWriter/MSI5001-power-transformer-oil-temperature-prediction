# 04｜数据预处理与序列构建

本章深入讲解如何将原始负载时序转换为可训练的样本，并保存为 `*.npy` 与标准化器 `*.pkl`。核心脚本位于：
- 推荐教学版：`scripts/preprocessing/optimized_preprocessing.py`
- 进阶/对照版：`scripts/preprocessing/data_preprocessing.py`

## 关键概念
- 标准化（`StandardScaler`）：让各特征处于相近量纲，便于训练。
- 滑动窗口（`lookback`）：把过去 `L` 个时间点的 6 个特征拼接为一个样本向量。
- 预测步长（`forecast_horizon`）：预测距离当前点后 `H` 个时间点的油温。

在优化版脚本中，三种配置的参数如下：
- `1h`：`lookback=16`、`forecast_horizon=4`
- `1d`：`lookback=32`、`forecast_horizon=96`
- `1w`：`lookback=64`、`forecast_horizon=672`

## 运行预处理
```bash
python scripts/preprocessing/optimized_preprocessing.py
```

输出说明：
- 训练/测试集：`X_train_*.npy`、`X_test_*.npy`、`y_train_*.npy`、`y_test_*.npy`
- 标准化器：`scaler_*.pkl`
- 控制台打印数据形状、时间范围、样本数量。

## 与进阶版的差异（可选）
`data_preprocessing.py` 展示了另一种时间分组切分方式（每 1000 样本一组，随机选择组作为测试），并使用更长的 `lookback`；适合作为对照实验：
- 对比不同 `lookback/H` 组合与切分策略对最终 `R²/RMSE` 的影响。

## 练习
- 修改 `optimized_preprocessing.py` 中的 `sample_size` 限制，观察样本数量对训练耗时与性能的影响。
- 为 `scaled_data` 添加时间特征（如小时、星期），评估是否提升性能。

完成本章后，你能稳定生成训练/测试分割与标准化器文件，为后续建模做准备。